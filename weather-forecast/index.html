<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast - Nearby Places</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- (Your full CSS styles from the previous code remain exactly the same here) -->
    <style>
        /* PASTE THE ENTIRE PREVIOUS <style> SECTION HERE */
        /* Do not change the CSS */
    </style>
</head>
<body>
    <!-- (Your full HTML body from the previous code remains exactly the same here) -->
    <!-- Do not change the HTML structure -->

    <script>
        // ✅ STEP 1: REPLACE THIS WITH YOUR REAL API KEY
        const API_KEY = 'YOUR_API_KEY_HERE'; // Get from: https://openweathermap.org/api

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const locateBtn = document.getElementById('locateBtn');
        const placesGrid = document.getElementById('placesGrid');
        const placesLoader = document.getElementById('placesLoader');
        const mainLoader = document.getElementById('mainLoader');
        const weatherContent = document.getElementById('weatherContent');
        const voiceStatus = document.getElementById('voiceStatus');

        // State
        let userLocation = null;
        let nearbyPlaces = [];
        let currentFilter = 'all';

        // Initialize App
        async function init() {
            try {
                await getUserLocation();
            } catch (error) {
                console.error("Init error:", error);
                showVoiceStatus("Could not initialize. Please check console.", 'error');
            }
        }

        // 1. GET USER'S LOCATION
        async function getUserLocation() {
            showMainLoader(true);
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        // Get city name and weather for current location
                        const cityName = await getCityFromCoords(userLocation.lat, userLocation.lon);
                        if (cityName) {
                            searchInput.value = cityName;
                            await getWeatherData(cityName, true);
                        }
                        // Now find nearby places (using a predefined list for demo)
                        await fetchNearbyPlaces();
                        showMainLoader(false);
                    },
                    (error) => {
                        console.error("Geolocation error:", error);
                        showMainLoader(false);
                        showVoiceStatus("Location access denied. Please allow permissions or search manually.", 'error');
                        // Fallback: Show major cities
                        showDefaultCities();
                    }
                );
            } else {
                showMainLoader(false);
                showVoiceStatus("Geolocation not supported by your browser.", 'error');
                showDefaultCities();
            }
        }

        // 2. GET WEATHER FOR A CITY (CORE FUNCTION)
        async function getWeatherData(cityName, isCurrentLocation = false) {
            if (!API_KEY || API_KEY === 'YOUR_API_KEY_HERE') {
                showVoiceStatus('⚠️ Please add your OpenWeatherMap API key in the code', 'error');
                return;
            }

            showMainLoader(true);
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(cityName)}&appid=${API_KEY}&units=metric`
                );
                const data = await response.json();

                if (data.cod === 200) {
                    updateWeatherDisplay(data);
                    if (isCurrentLocation) {
                        speakText(`Weather loaded for ${data.name}`);
                    }
                } else {
                    showVoiceStatus(`City "${cityName}" not found. Try another.`, 'error');
                }
            } catch (error) {
                console.error('Weather fetch error:', error);
                showVoiceStatus('Network error. Please try again.', 'error');
            } finally {
                showMainLoader(false);
            }
        }

        // 3. GET NEARBY PLACES (Using a list of major Indian cities for demo)
        async function fetchNearbyPlaces() {
            showPlacesLoader(true);
            placesGrid.innerHTML = '';

            // Demo list of places (you can modify this)
            const demoPlaces = [
                { name: "Mumbai", type: "city", lat: 19.0760, lon: 72.8777 },
                { name: "Delhi", type: "city", lat: 28.6139, lon: 77.2090 },
                { name: "Bangalore", type: "city", lat: 12.9716, lon: 77.5946 },
                { name: "Hyderabad", type: "city", lat: 17.3850, lon: 78.4867 },
                { name: "Chennai", type: "city", lat: 13.0827, lon: 80.2707 },
                { name: "Kolkata", type: "city", lat: 22.5726, lon: 88.3639 },
                { name: "Pune", type: "city", lat: 18.5204, lon: 73.8567 },
                { name: "Ahmedabad", type: "city", lat: 23.0225, lon: 72.5714 }
            ];

            nearbyPlaces = demoPlaces;
            await fetchWeatherForPlaces(nearbyPlaces);
            renderPlaces(nearbyPlaces);
            showPlacesLoader(false);
        }

        // 4. FETCH WEATHER FOR MULTIPLE PLACES
        async function fetchWeatherForPlaces(places) {
            const promises = places.map(async (place) => {
                try {
                    const response = await fetch(
                        `https://api.openweathermap.org/data/2.5/weather?lat=${place.lat}&lon=${place.lon}&units=metric&appid=${API_KEY}`
                    );
                    if (response.ok) {
                        const data = await response.json();
                        place.weather = {
                            temp: Math.round(data.main.temp),
                            description: data.weather[0].description,
                            icon: data.weather[0].icon,
                            humidity: data.main.humidity,
                            windSpeed: Math.round(data.wind.speed * 3.6)
                        };
                    }
                } catch (error) {
                    // Fallback demo data if API fails
                    place.weather = {
                        temp: 25 + Math.floor(Math.random() * 10),
                        description: 'Partly cloudy',
                        humidity: 60 + Math.floor(Math.random() * 20),
                        windSpeed: 5 + Math.floor(Math.random() * 10)
                    };
                }
            });
            await Promise.all(promises);
        }

        // 5. RENDER PLACES TO SCREEN
        function renderPlaces(places) {
            placesGrid.innerHTML = '';
            places.forEach(place => {
                const placeCard = document.createElement('div');
                placeCard.className = 'place-card';
                placeCard.innerHTML = `
                    <div class="place-header">
                        <div class="place-name">${place.name}</div>
                        <div class="place-type">${place.type.toUpperCase()}</div>
                    </div>
                    <div class="place-weather">
                        <div class="place-temp">${place.weather?.temp || '--'}°C</div>
                        <div>
                            <div class="place-desc">${place.weather?.description || '--'}</div>
                        </div>
                    </div>
                    <div class="place-details">
                        <div class="place-detail">
                            <i class="fas fa-droplet"></i>
                            <span>${place.weather?.humidity || '--'}%</span>
                        </div>
                        <div class="place-detail">
                            <i class="fas fa-wind"></i>
                            <span>${place.weather?.windSpeed || '--'} km/h</span>
                        </div>
                    </div>
                `;
                placeCard.addEventListener('click', async () => {
                    await getWeatherData(place.name);
                });
                placesGrid.appendChild(placeCard);
            });
        }

        // 6. UPDATE MAIN WEATHER DISPLAY
        function updateWeatherDisplay(data) {
            // Update all weather elements
            document.getElementById('weatherIcon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
            document.getElementById('currentTemp').textContent = `${Math.round(data.main.temp)}°C`;
            document.getElementById('currentDesc').textContent = data.weather[0].description;
            document.getElementById('currentLocation').textContent = `${data.name}, ${data.sys.country}`;
            document.getElementById('currentHumidity').textContent = `${data.main.humidity}%`;
            document.getElementById('currentWind').textContent = `${Math.round(data.wind.speed * 3.6)} km/h`;
            document.getElementById('currentFeelsLike').textContent = `${Math.round(data.main.feels_like)}°C`;
            document.getElementById('currentPressure').textContent = `${data.main.pressure} hPa`;

            weatherContent.style.display = 'block';
        }

        // 7. HELPER: GET CITY NAME FROM COORDINATES
        async function getCityFromCoords(lat, lon) {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${API_KEY}`
                );
                const data = await response.json();
                return data[0]?.name || "Your Location";
            } catch (error) {
                return "Your Location";
            }
        }

        // 8. SETUP EVENT LISTENERS
        function setupEventListeners() {
            searchBtn.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) getWeatherData(query);
            });

            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && searchInput.value.trim()) {
                    getWeatherData(searchInput.value.trim());
                }
            });

            locateBtn.addEventListener('click', () => {
                getUserLocation();
                speakText("Getting your location");
            });

            // Filter buttons (simplified)
            document.getElementById('filterAll').addEventListener('click', () => renderPlaces(nearbyPlaces));
            document.getElementById('refreshPlaces').addEventListener('click', fetchNearbyPlaces);
        }

        // 9. TEXT-TO-SPEECH
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance(text);
                speech.rate = 0.9;
                window.speechSynthesis.speak(speech);
            }
        }

        // 10. UI HELPER FUNCTIONS
        function showMainLoader(show) {
            mainLoader.classList.toggle('show', show);
            if (show) weatherContent.style.display = 'none';
        }

        function showPlacesLoader(show) {
            placesLoader.classList.toggle('show', show);
        }

        function showVoiceStatus(message, type = 'info') {
            voiceStatus.textContent = message;
            voiceStatus.className = 'voice-status show';
            setTimeout(() => voiceStatus.classList.remove('show'), 3000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            init();
        });
    </script>
</body>
</html>